<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Peak extraction of a single peak &mdash; SrMise 0.5.2 documentation</title>
    
    <link rel="stylesheet" href="../_static/nature.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '0.5.2',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="top" title="SrMise 0.5.2 documentation" href="../index.html" />
    <link rel="up" title="Tutorial" href="index.html" />
    <link rel="next" title="Summary of SrMise parameters" href="parameter_summary.html" />
    <link rel="prev" title="Tutorial" href="index.html" /> 
  </head>
  <body role="document">
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="parameter_summary.html" title="Summary of SrMise parameters"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="index.html" title="Tutorial"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">SrMise 0.5.2 documentation</a> &raquo;</li>
          <li class="nav-item nav-item-1"><a href="index.html" accesskey="U">Tutorial</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <blockquote>
<div></div></blockquote>
<div class="section" id="peak-extraction-of-a-single-peak">
<h1>Peak extraction of a single peak<a class="headerlink" href="#peak-extraction-of-a-single-peak" title="Permalink to this headline">¶</a></h1>
<div class="line-block">
<div class="line">Script: <a class="reference internal" href="#extract-single-peak-py">extract_single_peak.py</a></div>
<div class="line">Sample: <a class="reference external" href="index.html#ag">Ag</a></div>
</div>
<p>This introductory example shows how to extract the nearest-neighbor peak of an
X-ray PDF for crystalline (FCC) silver powder with experimentally determined
uncertainties.  It demonstrates basic input/output with SrMise, how to set the
region over which to extract peaks, and how to automatically estimate a linear
baseline.</p>
<p>First, plot the data without performing peak extraction.  The first argument
must be either a PDF (as here) or a .srmise file (described later) saved by
SrMise.</p>
<div class="highlight-python"><div class="highlight"><pre>srmise data/Ag_nyquist_qmax30.gr --no-extract --plot
</pre></div>
</div>
<p>This should result in an image very similar to the one below.  The top shows the
experimental data in blue.  The bottom shows the difference curve, which is
just the PDF itself since no baseline has been specified (it is identically 0),
and no peaks have been extracted.</p>
<p><img alt="images/extract_single_peak1.png" src="../_images/extract_single_peak1.png" /></p>
<p>By default peak extraction is performed over the entire PDF, but often only
peaks in a particular region are of immediate interest.  In this case the
nearest-neighbor peak near 2.9 Å is well separated from all other peaks, and
performing peak extraction from around 2 Å to 3.5 Å will be sufficient.  To
restrict peak extraction to this interval use the <code class="docutils literal"><span class="pre">--range</span></code> option, which
accepts a pair of values.</p>
<div class="highlight-python"><div class="highlight"><pre>srmise data/Ag_nyquist_qmax30.gr --no-extract --plot --range 2 3.5
</pre></div>
</div>
<p>The PDF baseline of a crystal is linear, and a reasonable crystal baseline can
often be automatically estimated.  To estimate baseline parameters
automatically, specify the type of baseline to use with the <code class="docutils literal"><span class="pre">--baseline</span></code>
option.  Here we specify a polynomial of degree 1, which is at present the only
baseline for which SrMise provides automatic estimation. Since the results of
peak extraction are conditioned on the baseline parameters, it is a good idea to
see whether they are reasonable.</p>
<div class="highlight-python"><div class="highlight"><pre>srmise data/Ag_nyquist_qmax30.gr --no-extract --plot --range 2 3.5
    --baseline &quot;Polynomial(degree=1)&quot;
</pre></div>
</div>
<p><img alt="images/extract_single_peak2.png" src="../_images/extract_single_peak2.png" /></p>
<p>The estimated baseline looks reasonable, so it&#8217;s time to perform peak extraction.
By default <code class="docutils literal"><span class="pre">srmise</span></code> performs extraction when run, so simply remove the
<code class="docutils literal"><span class="pre">--no-extract</span></code> option.</p>
<div class="highlight-python"><div class="highlight"><pre>srmise data/Ag_nyquist_qmax30.gr --plot --range 2 3.5
    --baseline &quot;Polynomial(degree=1)&quot;
</pre></div>
</div>
<p><img alt="images/extract_single_peak3.png" src="../_images/extract_single_peak3.png" /></p>
<p>The plot shows the fit to the data and difference curve.  The top inset shows
a vertical marker at the position of the extracted peak.  The console output
indicates the nearest-neighbor peak is located at 2.9007 ± 0.0019 Å, with width
(as full-width at half-maximum) 0.2672 ± 0.0049 Å, and intensity 9.8439 ±
0.1866.  (Results may vary slightly by platform.)  Since this PDF has
reliable uncertainties, the reported parameter uncertainties are quantitatively
sound.  Note also that these parameters are for a Gaussian in the radial
distribution function (RDF) corresponding to the experimental PDF, rather than
the Gaussian divided by radius which is the actual function being fit to the
PDF.</p>
<p>SrMise has two basic formats for saving data.  The first are .srmise files,
which record all information about the parameters and results of peak
extraction.  These files may be loaded by <code class="docutils literal"><span class="pre">srmise</span></code> and in Python scripts.  The
second are .pwa files, which are intended as a human readable summary, but do
not contain enough information to reproduce peak extraction results.  These
may be saved with the <code class="docutils literal"><span class="pre">--save</span> <span class="pre">filename.srmise</span></code> and <code class="docutils literal"><span class="pre">--savepwa</span> <span class="pre">filename.pwa</span></code>
options.</p>
<p>The script gives results identical to the commands above, and also saves both a
.srmise and .pwa file in the <em>output</em> directory.  Verify this by running it.</p>
<div class="highlight-python"><div class="highlight"><pre>python extract_single_peak.py
</pre></div>
</div>
<div class="section" id="script-extract-single-peak-py">
<span id="extract-single-peak-py"></span><h2>Script (extract_single_peak.py)<a class="headerlink" href="#script-extract-single-peak-py" title="Permalink to this headline">¶</a></h2>
<div class="highlight-python"><div class="highlight"><pre><span class="c">#!/usr/bin/env python</span>
<span class="c">##############################################################################</span>
<span class="c">#</span>
<span class="c"># diffpy.srmise     by Luke Granlund</span>
<span class="c">#                   (c) 2015 trustees of the Michigan State University.</span>
<span class="c">#                   All rights reserved.</span>
<span class="c">#</span>
<span class="c"># File coded by:    Luke Granlund</span>
<span class="c">#</span>
<span class="c"># See LICENSE.txt for license information.</span>
<span class="c">#</span>
<span class="c">##############################################################################</span>
<span class="sd">&quot;&quot;&quot;Example of extracting an isolated peak from a crystalline PDF.</span>

<span class="sd">This example shows how to extract an isolated peak from a simple crystalline</span>
<span class="sd">PDF with accurate experimentally-determined uncertainties using a crystalline</span>
<span class="sd">baseline estimated from the data.  This is the simplest use case</span>
<span class="sd">for diffpy.srmise, and covers initializing diffpy.srmise, defining extraction</span>
<span class="sd">parameters, running peak extraction, and saving the results.</span>

<span class="sd">This script is equivalent to running</span>
<span class="sd">srmise data/Ag_nyquist_qmax30.gr --range 2. 3.5 \</span>
<span class="sd">    --baseline &quot;Polynomial(degree=1)&quot; --save output/extract_single_peak.srmise \</span>
<span class="sd">    --pwa output/extract_single_peak.pwa --plot</span>
<span class="sd">at the command line.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">as</span> <span class="nn">plt</span>

<span class="kn">from</span> <span class="nn">diffpy.srmise</span> <span class="kn">import</span> <span class="n">PDFPeakExtraction</span>
<span class="kn">from</span> <span class="nn">diffpy.srmise.baselines</span> <span class="kn">import</span> <span class="n">Polynomial</span>
<span class="kn">from</span> <span class="nn">diffpy.srmise.applications.plot</span> <span class="kn">import</span> <span class="n">makeplot</span>

<span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="n">plot</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
    
    <span class="c">## Initialize peak extraction</span>
    <span class="c"># Create peak extraction object</span>
    <span class="n">ppe</span> <span class="o">=</span> <span class="n">PDFPeakExtraction</span><span class="p">()</span>
    
    <span class="c"># Load the PDF from a file</span>
    <span class="n">ppe</span><span class="o">.</span><span class="n">loadpdf</span><span class="p">(</span><span class="s">&quot;data/Ag_nyquist_qmax30.gr&quot;</span><span class="p">)</span>

    <span class="c">## Set up extraction parameters.</span>
    <span class="c"># For convenience we add all parameters to a dictionary before passing them</span>
    <span class="c"># to the extraction object.</span>
    <span class="c">#</span>
    <span class="c"># The &quot;rng&quot; (range) parameter defines the region over which peaks will be</span>
    <span class="c"># extracted and fit.  For the well isolated nearest-neighbor silver peak,</span>
    <span class="c"># which occurs near 2.9 angstroms, it is sufficient to perform extraction</span>
    <span class="c"># between 2 and 3.5 angstroms.</span>
    <span class="c">#</span>
    <span class="c"># The &quot;baseline&quot; parameter lets us define the PDF baseline, which is</span>
    <span class="c"># linear for a crystal.  If a linear baseline is specified without</span>
    <span class="c"># numerical parameters diffpy.srmise attempts to estimate them from the</span>
    <span class="c"># data, and this is usually sufficient when peaks do not overlap much.</span>
    <span class="n">kwds</span> <span class="o">=</span> <span class="p">{}</span> 
    <span class="n">kwds</span><span class="p">[</span><span class="s">&quot;rng&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mf">2.0</span><span class="p">,</span> <span class="mf">3.5</span><span class="p">]</span>
    <span class="n">kwds</span><span class="p">[</span><span class="s">&quot;baseline&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Polynomial</span><span class="p">(</span><span class="n">degree</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    
    <span class="c"># Apply peak extraction parameters.</span>
    <span class="n">ppe</span><span class="o">.</span><span class="n">setvars</span><span class="p">(</span><span class="o">**</span><span class="n">kwds</span><span class="p">)</span>

    <span class="c">## Perform peak extraction</span>
    <span class="n">ppe</span><span class="o">.</span><span class="n">extract</span><span class="p">()</span>
    
    <span class="c">## Save output</span>
    <span class="c"># The write() method saves a file which preserves all aspects of peak</span>
    <span class="c"># extraction and its results, by convention using the .srmise extension,</span>
    <span class="c"># and which can later be read by diffpy.srmise.</span>
    <span class="c">#</span>
    <span class="c"># The writepwa() method saves a file intended as a human-readable summary.</span>
    <span class="c"># In particular, it reports the position, width (as full-width at</span>
    <span class="c"># half-maximum), and area of of extracted peaks.  The reported values</span>
    <span class="c"># are for Gaussians in the radial distribution function (RDF) corresponding</span>
    <span class="c"># to this PDF.</span>
    <span class="n">ppe</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;output/extract_single_peak.srmise&quot;</span><span class="p">)</span>
    <span class="n">ppe</span><span class="o">.</span><span class="n">writepwa</span><span class="p">(</span><span class="s">&quot;output/extract_single_peak.pwa&quot;</span><span class="p">)</span>

    <span class="c">## Plot results.</span>
    <span class="c"># Display plot of extracted peak.  It is also possible to plot an existing</span>
    <span class="c"># .srmise file from the command line using</span>
    <span class="c">#     srmise output/Ag_singlepeak.srmise --no-extract --plot</span>
    <span class="c"># For additional plotting options, run &quot;srmiseplot --help&quot;.</span>
    <span class="k">if</span> <span class="n">plot</span><span class="p">:</span>
        <span class="n">makeplot</span><span class="p">(</span><span class="n">ppe</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">run</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Peak extraction of a single peak</a><ul>
<li><a class="reference internal" href="#script-extract-single-peak-py">Script (extract_single_peak.py)</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="index.html"
                        title="previous chapter">Tutorial</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="parameter_summary.html"
                        title="next chapter">Summary of SrMise parameters</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../_sources/tutorial/extract_single_peak.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="parameter_summary.html" title="Summary of SrMise parameters"
             >next</a> |</li>
        <li class="right" >
          <a href="index.html" title="Tutorial"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">SrMise 0.5.2 documentation</a> &raquo;</li>
          <li class="nav-item nav-item-1"><a href="index.html" >Tutorial</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &copy; Copyright 2015, Board of Trustees of Michigan State University.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.3.1.
    </div>
  </body>
</html>