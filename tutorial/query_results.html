<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Querying SrMise results &mdash; SrMise 0.5.2 documentation</title>
    
    <link rel="stylesheet" href="../_static/nature.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '0.5.2',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="top" title="SrMise 0.5.2 documentation" href="../index.html" />
    <link rel="up" title="Tutorial" href="index.html" />
    <link rel="next" title="Multimodeling with known uncertainty" href="multimodel_known_uncertainties.html" />
    <link rel="prev" title="Peak fitting" href="fit_initial.html" /> 
  </head>
  <body role="document">
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="multimodel_known_uncertainties.html" title="Multimodeling with known uncertainty"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="fit_initial.html" title="Peak fitting"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">SrMise 0.5.2 documentation</a> &raquo;</li>
          <li class="nav-item nav-item-1"><a href="index.html" accesskey="U">Tutorial</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <blockquote>
<div></div></blockquote>
<div class="section" id="querying-srmise-results">
<h1>Querying SrMise results<a class="headerlink" href="#querying-srmise-results" title="Permalink to this headline">¶</a></h1>
<div class="line-block">
<div class="line">Script: <a class="reference internal" href="#query-results-py">query_results.py</a></div>
<div class="line">Sample: <a class="reference external" href="index.html#ag">Ag</a></div>
</div>
<p>In previous examples the results of peak extraction/fitting were read from the
console, but this is not always convenient.  This example demonstrates the
basic methods for querying SrMise objects about their parameters and values
within scripts.</p>
<p>First, visually check that the baseline obtained in the earlier silver example
(set using the <code class="docutils literal"><span class="pre">--bsrmise</span> <span class="pre">filename.srmise</span></code> option) is reasonable over a
larger range.</p>
<div class="highlight-python"><div class="highlight"><pre>srmise data/Ag_nyquist_qmax30.gr --no-extract --plot --range 2 10
    --bsrmise output/query_results.srmise
</pre></div>
</div>
<p><img alt="images/query_results1.png" src="../_images/query_results1.png" /></p>
<p>Next, run</p>
<div class="highlight-python"><div class="highlight"><pre>python query_results.py
</pre></div>
</div>
<p>to perform peak extraction, the example analysis, and obtain the two plots
below.</p>
<p><img alt="images/query_results2.png" src="../_images/query_results2.png" /></p>
<p><img alt="images/query_results3.png" src="../_images/query_results3.png" /></p>
<p>Now the methods of the script are described.  The way to evaluate model
uncertainties with SrMise is with a <code class="docutils literal"><span class="pre">ModelCovariance</span></code> instance returned after
peak extraction (or fitting).</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">cov</span> <span class="o">=</span> <span class="n">ppe</span><span class="o">.</span><span class="n">extract</span><span class="p">()</span>
</pre></div>
</div>
<p>Model parameters denoted by a tuple <code class="docutils literal"><span class="pre">(i,j)</span></code>, representing the <em>j</em>th
parameter of the <em>i</em>th peak, are passed to this object&#8217;s methods.  For a
Gaussian over r, the order of peak parameters in SrMise is position, width, and
area.  Thus, the area of the nearest-neighbor peak is denoted by the tuple
(0,2). (Indexing is zero-based.) By convention, the last element (<code class="docutils literal"><span class="pre">i=-1</span></code>) is
the baseline. The methods of greatest interest are as follows.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># Get (value, uncertainty) tuple for this parameter</span>
<span class="n">cov</span><span class="o">.</span><span class="n">get</span><span class="p">((</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">))</span>

<span class="c"># Get just the value of the parameter</span>
<span class="n">cov</span><span class="o">.</span><span class="n">getvalue</span><span class="p">((</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">))</span>

<span class="c"># Get just the uncertainty of the parameter</span>
<span class="n">cov</span><span class="o">.</span><span class="n">getuncertainty</span><span class="p">((</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">))</span>

<span class="c"># Get the covariance between two parameters</span>
<span class="n">cov</span><span class="o">.</span><span class="n">getcovariance</span><span class="p">((</span><span class="n">i1</span><span class="p">,</span><span class="n">j1</span><span class="p">),</span> <span class="p">(</span><span class="n">i2</span><span class="p">,</span><span class="n">j2</span><span class="p">))</span>

<span class="c"># Get the correlation between two parameters</span>
<span class="n">cov</span><span class="o">.</span><span class="n">getcorrelation</span><span class="p">((</span><span class="n">i1</span><span class="p">,</span><span class="n">j1</span><span class="p">),</span> <span class="p">(</span><span class="n">i2</span><span class="p">,</span><span class="n">j2</span><span class="p">))</span>
</pre></div>
</div>
<p>Suppose, for example, one wants to emperically estimate the number of silver
atoms contributing to each occupied coordination shell of the FCC structure,
knowing that the coordination number (i.e. nearest neighbors) of an ideal FCC
structure is exactly 12.  For a monoelemental material the intensity of a peak
in a properly normalized PDF should equal the number of contributing atoms in
the corresponding shell.  Thus, the intensity of the nearest neighbor peak
permits an estimate of the PDF scale factor, and using that an estimate of other
shell&#8217;s occupancy.  This simple procedure is implemented in the script using
model parameters and uncertainties obtained with the methods above.</p>
<p>Another useful capability is calculating the value of a model, in whole or
part.  Given a PDFPeakExtraction instance <code class="docutils literal"><span class="pre">ppe</span></code> and a numpy array <code class="docutils literal"><span class="pre">r</span></code>, the
usual methods are</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># Return sum of peaks and baseline, evaluated on the current grid, or r.</span>
<span class="n">ppe</span><span class="o">.</span><span class="n">extracted</span><span class="o">.</span><span class="n">value</span><span class="p">()</span>
<span class="n">ppe</span><span class="o">.</span><span class="n">extracted</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>

<span class="c"># Return residual (data - model) on the current grid.</span>
<span class="n">ppe</span><span class="o">.</span><span class="n">extracted</span><span class="o">.</span><span class="n">residual</span><span class="p">()</span>

<span class="c"># Return the baseline evaluated on the current grid, or r.</span>
<span class="n">ppe</span><span class="o">.</span><span class="n">extracted</span><span class="o">.</span><span class="n">valuebl</span><span class="p">()</span>
<span class="n">ppe</span><span class="o">.</span><span class="n">extracted</span><span class="o">.</span><span class="n">valuebl</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>

<span class="c"># The ith peak evaluated on r</span>
<span class="n">ppe</span><span class="o">.</span><span class="n">extracted</span><span class="o">.</span><span class="n">model</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>

<span class="c"># The baseline evaluated on r</span>
<span class="n">ppe</span><span class="o">.</span><span class="n">extracted</span><span class="o">.</span><span class="n">baseline</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>
</pre></div>
</div>
<div class="section" id="script-query-results-py">
<span id="query-results-py"></span><h2>Script (query_results.py)<a class="headerlink" href="#script-query-results-py" title="Permalink to this headline">¶</a></h2>
<div class="highlight-python"><div class="highlight"><pre><span class="c">#!/usr/bin/env python</span>
<span class="c">##############################################################################</span>
<span class="c">#</span>
<span class="c"># diffpy.srmise     by Luke Granlund</span>
<span class="c">#                   (c) 2015 trustees of the Michigan State University.</span>
<span class="c">#                   All rights reserved.</span>
<span class="c">#</span>
<span class="c"># File coded by:    Luke Granlund</span>
<span class="c">#</span>
<span class="c"># See LICENSE.txt for license information.</span>
<span class="c">#</span>
<span class="c">##############################################################################</span>
<span class="sd">&quot;&quot;&quot;Example of extracting multiple peaks and accessing results programatically.</span>

<span class="sd">This example shows how to extract a range of peaks from a simple crystalline</span>
<span class="sd">PDF using a crystalline baseline obtained from an existing trial.  It shows</span>
<span class="sd">how to access the value and uncertainty of peak parameters, including</span>
<span class="sd">transforming between different peak parameterizations.  Finally, it shows how</span>
<span class="sd">to evaluate the model on an arbitrary grid.</span>

<span class="sd">The peaks extracted by this script are equivalent to those obtained running</span>
<span class="sd">srmise data/Ag_nyquist_qmax30.gr --range 2. 10. \</span>
<span class="sd">    --bsrmise output/extract_single_peak.srmise \</span>
<span class="sd">    --save output/query_results.srmise \</span>
<span class="sd">    --pwa output/query_results.pwa --plot</span>
<span class="sd">at the command line.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">as</span> <span class="nn">plt</span>

<span class="kn">from</span> <span class="nn">diffpy.srmise</span> <span class="kn">import</span> <span class="n">PDFPeakExtraction</span>
<span class="kn">from</span> <span class="nn">diffpy.srmise</span> <span class="kn">import</span> <span class="n">ModelCovariance</span>
<span class="kn">from</span> <span class="nn">diffpy.srmise.applications.plot</span> <span class="kn">import</span> <span class="n">makeplot</span>

<span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="n">plot</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
    
    <span class="c">## Initialize peak extraction</span>
    <span class="c"># Create peak extraction object</span>
    <span class="n">ppe</span> <span class="o">=</span> <span class="n">PDFPeakExtraction</span><span class="p">()</span>
    
    <span class="c"># Load the PDF from a file</span>
    <span class="n">ppe</span><span class="o">.</span><span class="n">loadpdf</span><span class="p">(</span><span class="s">&quot;data/Ag_nyquist_qmax30.gr&quot;</span><span class="p">)</span>
    
    <span class="c"># Obtain baseline from a saved diffpy.srmise trial.  This is not the</span>
    <span class="c"># initial baseline estimate from the previous example, but the baseline</span>
    <span class="c"># after both it and the extracted peaks have been fit to the data.</span>
    <span class="n">ppebl</span> <span class="o">=</span> <span class="n">PDFPeakExtraction</span><span class="p">()</span>
    <span class="n">ppebl</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="s">&quot;output/extract_single_peak.srmise&quot;</span><span class="p">)</span>
    <span class="n">baseline</span> <span class="o">=</span> <span class="n">ppebl</span><span class="o">.</span><span class="n">extracted</span><span class="o">.</span><span class="n">baseline</span>

    <span class="c">## Set up extraction parameters.</span>
    <span class="c"># Peaks are extracted between 2 and 10 angstroms, using the baseline</span>
    <span class="c"># from the isolated peak example.</span>
    <span class="n">kwds</span> <span class="o">=</span> <span class="p">{}</span> 
    <span class="n">kwds</span><span class="p">[</span><span class="s">&quot;rng&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mf">2.0</span><span class="p">,</span> <span class="mf">10.</span><span class="p">]</span>
    <span class="n">kwds</span><span class="p">[</span><span class="s">&quot;baseline&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">baseline</span>
    
    <span class="c"># Apply peak extraction parameters.</span>
    <span class="n">ppe</span><span class="o">.</span><span class="n">setvars</span><span class="p">(</span><span class="o">**</span><span class="n">kwds</span><span class="p">)</span>

    <span class="c">## Perform peak extraction, and retain object containing a copy of the</span>
    <span class="c"># model and the full covariance matrix.</span>
    <span class="n">cov</span> <span class="o">=</span> <span class="n">ppe</span><span class="o">.</span><span class="n">extract</span><span class="p">()</span>
    

    <span class="k">print</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">======= Accessing SrMise Results ========&quot;</span>
    <span class="c">## Accessing results of extraction</span>
    <span class="c">#</span>
    <span class="c"># Model parameters are organized using a nested structure, with a list</span>
    <span class="c"># of peaks each of which is a list of parameters, similar to the the</span>
    <span class="c"># following schematic.</span>
    <span class="c">#     Peak</span>
    <span class="c">#         Position</span>
    <span class="c">#         Width</span>
    <span class="c">#         Area</span>
    <span class="c">#     Peak</span>
    <span class="c">#         Position</span>
    <span class="c">#         Width</span>
    <span class="c">#         Area*</span>
    <span class="c">#     ...</span>
    <span class="c">#     Baseline</span>
    <span class="c">#         Slope</span>
    <span class="c">#         Intercept</span>
    <span class="c"># By convention, the baseline is the final &quot;peak.&quot;  The ModelCovariance</span>
    <span class="c"># object returned by extract() can return information about any peak by</span>
    <span class="c"># using the appropriate tuple of indices (i,j).  That is, (i,j) denotes</span>
    <span class="c"># the jth parameter of the ith peak.  For example, the starred parameter</span>
    <span class="c"># above is the area (index = 2) of the next nearest neighbor (index = 1)</span>
    <span class="c"># peak. Thus, this parameter can be referenced as (1,2).  Several examples</span>
    <span class="c"># are presented below.</span>
    

    <span class="k">print</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">------ Parameter values and uncertainties ------&quot;</span>
    <span class="c"># ModelCovariance.get() returns a (value, uncertainty) tuple for a given</span>
    <span class="c"># parameter.  These are the results for the nearest-neighbor peak.</span>
    <span class="n">p0</span> <span class="o">=</span> <span class="n">cov</span><span class="o">.</span><span class="n">get</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">))</span>
    <span class="n">w0</span> <span class="o">=</span> <span class="n">cov</span><span class="o">.</span><span class="n">get</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span>
    <span class="n">a0</span> <span class="o">=</span> <span class="n">cov</span><span class="o">.</span><span class="n">get</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span>
    <span class="k">print</span> <span class="s">&quot;Nearest-neighbor peak: &quot;</span>
    <span class="k">print</span> <span class="s">&quot;    position = </span><span class="si">%f</span><span class="s"> +/- </span><span class="si">%f</span><span class="s">&quot;</span> <span class="o">%</span><span class="n">p0</span>
    <span class="k">print</span> <span class="s">&quot;    width = </span><span class="si">%f</span><span class="s"> +/- </span><span class="si">%f</span><span class="s">&quot;</span> <span class="o">%</span><span class="n">w0</span>
    <span class="k">print</span> <span class="s">&quot;    area = </span><span class="si">%f</span><span class="s"> +/- </span><span class="si">%f</span><span class="s">&quot;</span> <span class="o">%</span><span class="n">a0</span>
    <span class="k">print</span> <span class="s">&quot;    Covariance(width, area) = &quot;</span><span class="p">,</span> <span class="n">cov</span><span class="o">.</span><span class="n">getcovariance</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">),(</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span>

    <span class="c"># Baseline parameters.  By convention, baseline is final element in cov.</span>
    <span class="p">(</span><span class="n">slope</span><span class="p">,</span> <span class="n">intercept</span><span class="p">)</span> <span class="o">=</span> <span class="n">cov</span><span class="o">.</span><span class="n">model</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">print</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">The linear baseline B(r)=</span><span class="si">%f</span><span class="s">*r + </span><span class="si">%f</span><span class="s">&quot;</span> \
          <span class="o">%</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">par</span> <span class="k">for</span> <span class="n">par</span> <span class="ow">in</span> <span class="n">cov</span><span class="o">.</span><span class="n">model</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>


    <span class="k">print</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s"> ------ Uncertainties from a Saved File --------&quot;</span>
    <span class="c"># A .srmise file does not save the full covariance matrix, so it must be</span>
    <span class="c"># recalculated when loading from these files.  For example, here is the</span>
    <span class="c"># nearest-neighbor peak in the file which we used to define the initial</span>
    <span class="c"># baseline.</span>
    <span class="n">cov2</span> <span class="o">=</span> <span class="n">ModelCovariance</span><span class="p">()</span>
    <span class="n">ppebl</span><span class="o">.</span><span class="n">extracted</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">fitbaseline</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">cov</span><span class="o">=</span><span class="n">cov2</span><span class="p">,</span> <span class="n">cov_format</span><span class="o">=</span><span class="s">&quot;default_output&quot;</span><span class="p">)</span>
    <span class="n">p0_saved</span> <span class="o">=</span> <span class="n">cov2</span><span class="o">.</span><span class="n">get</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">))</span>
    <span class="n">w0_saved</span> <span class="o">=</span> <span class="n">cov2</span><span class="o">.</span><span class="n">get</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span>
    <span class="n">a0_saved</span> <span class="o">=</span> <span class="n">cov2</span><span class="o">.</span><span class="n">get</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span>
    <span class="k">print</span> <span class="s">&quot;Nearest-neighbor peak:&quot;</span>
    <span class="k">print</span> <span class="s">&quot;    position = </span><span class="si">%f</span><span class="s"> +/- </span><span class="si">%f</span><span class="s">&quot;</span> <span class="o">%</span><span class="n">p0_saved</span>
    <span class="k">print</span> <span class="s">&quot;    width == </span><span class="si">%f</span><span class="s"> +/- </span><span class="si">%f</span><span class="s">&quot;</span> <span class="o">%</span><span class="n">w0_saved</span>
    <span class="k">print</span> <span class="s">&quot;    area = = </span><span class="si">%f</span><span class="s"> +/- </span><span class="si">%f</span><span class="s">&quot;</span> <span class="o">%</span><span class="n">a0_saved</span>
    <span class="k">print</span> <span class="s">&quot;    Covariance(width, area) = &quot;</span><span class="p">,</span> <span class="n">cov2</span><span class="o">.</span><span class="n">getcovariance</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">),(</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span>


    <span class="k">print</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s"> ---------- Alternate Parameterizations ---------&quot;</span>
    <span class="c">## Different Parameterizations</span>
    <span class="c"># Peaks and baselines may have equivalent parameterizations that are useful</span>
    <span class="c"># in different situations.  For example, the types defined by the</span>
    <span class="c"># GaussianOverR peak function are:</span>
    <span class="c">#   &quot;internal&quot; - Used in diffpy.srmise calculations, explicitly enforces a</span>
    <span class="c">#                maximum peak width</span>
    <span class="c">#   &quot;pwa&quot; - The position, width (full-width at half-maximum), area.</span>
    <span class="c">#   &quot;mu_sigma_area&quot; - The position, width (the distribution standard</span>
    <span class="c">#                     deviation sigma), area.</span>
    <span class="c">#   &quot;default_output&quot; - Defines default format to use in most user-facing</span>
    <span class="c">#                      scenarios. Maps to the &quot;pwa&quot; parameterization.</span>
    <span class="c">#   &quot;default_input&quot; - Defines default format to use when specifying peak</span>
    <span class="c">#                     parameters.  Maps to the &quot;internal&quot; parameterization.</span>
    <span class="c"># All diffpy.srmise peak and baseline functions are required to have the</span>
    <span class="c"># &quot;internal&quot;, &quot;default_output&quot;, and &quot;default_input&quot; formats.  In many</span>
    <span class="c"># cases, such as polynomial baselines, all of these are equivalent.</span>
    <span class="c">#</span>
    <span class="c"># Suppose you want to know peak widths in terms of the standard deviation</span>
    <span class="c"># sigma of the Gaussian distribution.  It is then appropriate to convert</span>
    <span class="c"># all peaks to the &quot;mu_sigma_area&quot; format.  Valid options for the &quot;parts&quot;</span>
    <span class="c"># keyword are &quot;peaks&quot;, &quot;baseline&quot;, or a sequence of indices (e.g. [1,2,3]</span>
    <span class="c"># would transform the second, third, and fourth peaks).  If the keyword</span>
    <span class="c"># is omitted, the transformation is attempted for all parts of the fit.</span>
    <span class="n">cov</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">in_format</span><span class="o">=</span><span class="s">&quot;pwa&quot;</span><span class="p">,</span> <span class="n">out_format</span><span class="o">=</span><span class="s">&quot;mu_sigma_area&quot;</span><span class="p">,</span> <span class="n">parts</span><span class="o">=</span><span class="s">&quot;peaks&quot;</span><span class="p">)</span>
    <span class="k">print</span> <span class="s">&quot;Width (sigma) of nearest-neighbor peak: </span><span class="si">%f</span><span class="s"> +/- </span><span class="si">%f</span><span class="s">&quot;</span> <span class="o">%</span><span class="n">cov</span><span class="o">.</span><span class="n">get</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span>


    <span class="k">print</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s"> ------------ Highly Correlated Parameters ------------&quot;</span>
    <span class="c"># Highly-correlated parameters can indicate difficulties constraining the</span>
    <span class="c"># fit.  This function lists all pairs of parameters with an absolute value</span>
    <span class="c"># of correlation which exceeds a given threshold.</span>
    <span class="k">print</span> <span class="s">&quot;|Correlation| &gt; 0.9:&quot;</span>
    <span class="k">print</span> <span class="s">&quot;par1     par2    corr(par1, par2)&quot;</span>
    <span class="k">print</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">cov</span><span class="o">.</span><span class="n">correlationwarning</span><span class="p">(</span><span class="o">.</span><span class="mi">9</span><span class="p">))</span>


    <span class="k">print</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">-------- Estimate coordination shell occupancy ---------&quot;</span>
    <span class="c"># Estimate the scale factor and its uncertainty from first peak&#39;s intensity.</span>
    <span class="c"># G_normalized = scale * G_observed</span>
    <span class="c"># dscale = scale * dG_observed/G_observed</span>
    <span class="n">scale</span> <span class="o">=</span> <span class="mf">12.</span><span class="o">/</span><span class="n">a0</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">dscale</span> <span class="o">=</span> <span class="n">scale</span> <span class="o">*</span> <span class="n">a0</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="n">a0</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">print</span> <span class="s">&quot;Estimate scale factor assuming nearest-neighbor intensity = 12&quot;</span>
    <span class="k">print</span> <span class="s">&quot;Scale factor is </span><span class="si">%f</span><span class="s"> +/- </span><span class="si">%f</span><span class="s">&quot;</span> <span class="o">%</span><span class="p">(</span><span class="n">scale</span><span class="p">,</span> <span class="n">dscale</span><span class="p">)</span>

    <span class="c"># Reference for number of atoms in coordination shells for FCC.</span>
    <span class="c"># http://chem-faculty.lsu.edu/watkins/MERLOT/cubic_neighbors/cubic_near_neighbors.html</span>
    <span class="n">ideal_intensity</span> <span class="o">=</span> <span class="p">[</span><span class="mi">12</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">24</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">24</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">48</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">36</span><span class="p">,</span> <span class="mi">24</span><span class="p">,</span> <span class="mi">24</span><span class="p">,</span> <span class="mi">24</span><span class="p">]</span>
    
    <span class="c"># Calculated the scaled intensities and uncertainties.</span>
    <span class="n">intensity</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">cov</span><span class="o">.</span><span class="n">model</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
        <span class="p">(</span><span class="n">area</span><span class="p">,</span> <span class="n">darea</span><span class="p">)</span> <span class="o">=</span> <span class="n">cov</span><span class="o">.</span><span class="n">get</span><span class="p">((</span><span class="n">i</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span>
        <span class="n">area</span> <span class="o">*=</span> <span class="n">scale</span>
        <span class="n">darea</span> <span class="o">=</span> <span class="n">area</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">dscale</span><span class="o">/</span><span class="n">scale</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">darea</span><span class="o">/</span><span class="n">area</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">intensity</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">ideal_intensity</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">area</span><span class="p">,</span> <span class="n">darea</span><span class="p">))</span>
    
    <span class="k">print</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">Intensity&quot;</span>
    <span class="k">print</span> <span class="s">&quot;Ideal: Estimated&quot;</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">intensity</span><span class="p">:</span>
        <span class="k">print</span> <span class="s">&quot;</span><span class="si">%i</span><span class="s">: </span><span class="si">%f</span><span class="s"> +/- </span><span class="si">%f</span><span class="s">&quot;</span> <span class="o">%</span><span class="n">i</span>

    <span class="k">print</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">Total intensity&quot;</span>
    <span class="c"># It is possible to iterate over peaks directly without using indices.</span>
    <span class="c"># In addition, peak parameters can be accessed using string keys.  For the</span>
    <span class="c"># Gaussian over r all of &quot;position&quot;, &quot;width&quot;, and &quot;area&quot; are valid.</span>
    <span class="n">total_observed_intensity</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">total_ideal_intensity</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">peak</span><span class="p">,</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">cov</span><span class="o">.</span><span class="n">model</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">ideal_intensity</span><span class="p">):</span>
        <span class="n">total_observed_intensity</span> <span class="o">+=</span> <span class="n">scale</span><span class="o">*</span><span class="n">peak</span><span class="p">[</span><span class="s">&quot;area&quot;</span><span class="p">]</span>
        <span class="n">total_ideal_intensity</span> <span class="o">+=</span> <span class="n">ii</span>
    <span class="k">print</span> <span class="s">&quot;Ideal: Observed (using estimated scale factor)&quot;</span>
    <span class="k">print</span> <span class="s">&quot;</span><span class="si">%i</span><span class="s">: </span><span class="si">%f</span><span class="s">&quot;</span> <span class="o">%</span><span class="p">(</span><span class="n">total_ideal_intensity</span><span class="p">,</span> <span class="n">total_observed_intensity</span><span class="p">)</span>


    <span class="c">## Save output</span>
    <span class="n">ppe</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;output/query_results.srmise&quot;</span><span class="p">)</span>
    <span class="n">ppe</span><span class="o">.</span><span class="n">writepwa</span><span class="p">(</span><span class="s">&quot;output/query_results.pwa&quot;</span><span class="p">)</span>


    <span class="c">## Evaluating a model.</span>
    <span class="c"># Although the ModelCovariance object is useful, the model used for fitting</span>
    <span class="c"># can be directly accessed through PDFPeakExtraction as well, albeit</span>
    <span class="c"># without uncertainties.  This is particularly helpful when evaluating a</span>
    <span class="c"># model since the parameters stay in the &quot;internal&quot; format used for</span>
    <span class="c"># calculations.  For example, here we plot the data and every second peak</span>
    <span class="c"># on an arbitrary grid.  Unlike with ModelCovariance, the baseline and</span>
    <span class="c"># peaks are kept separate.</span>
    <span class="k">if</span> <span class="n">plot</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
        <span class="n">grid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="o">.</span><span class="mo">01</span><span class="p">)</span>
        <span class="n">bl</span> <span class="o">=</span> <span class="n">ppe</span><span class="o">.</span><span class="n">extracted</span><span class="o">.</span><span class="n">baseline</span>
        <span class="n">everysecondpeak</span> <span class="o">=</span> <span class="n">ppe</span><span class="o">.</span><span class="n">extracted</span><span class="o">.</span><span class="n">model</span><span class="p">[::</span><span class="mi">2</span><span class="p">]</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ppe</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">ppe</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="s">&#39;o&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">peak</span> <span class="ow">in</span> <span class="n">everysecondpeak</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">grid</span><span class="p">,</span> <span class="n">bl</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="n">grid</span><span class="p">)</span> <span class="o">+</span> <span class="n">peak</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="n">grid</span><span class="p">))</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">run</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Querying SrMise results</a><ul>
<li><a class="reference internal" href="#script-query-results-py">Script (query_results.py)</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="fit_initial.html"
                        title="previous chapter">Peak fitting</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="multimodel_known_uncertainties.html"
                        title="next chapter">Multimodeling with known uncertainty</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../_sources/tutorial/query_results.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="multimodel_known_uncertainties.html" title="Multimodeling with known uncertainty"
             >next</a> |</li>
        <li class="right" >
          <a href="fit_initial.html" title="Peak fitting"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">SrMise 0.5.2 documentation</a> &raquo;</li>
          <li class="nav-item nav-item-1"><a href="index.html" >Tutorial</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &copy; Copyright 2015, Board of Trustees of Michigan State University.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.3.1.
    </div>
  </body>
</html>