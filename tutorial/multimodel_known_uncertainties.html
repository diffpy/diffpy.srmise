<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Multimodeling with known uncertainty &mdash; diffpy.srmise 0.6.0 documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=fa44fd50" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=19f00094" />

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../_static/jquery.js?v=5d32c60e"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../_static/documentation_options.js?v=dda85ae5"></script>
        <script src="../_static/doctools.js?v=9a2dae69"></script>
        <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Multimodeling with unknown uncertainty" href="multimodel_unknown_uncertainties.html" />
    <link rel="prev" title="Querying SrMise results" href="query_results.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            diffpy.srmise
          </a>
              <div class="version">
                0.6.0
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Tutorial</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="extract_single_peak.html">Peak extraction of a single peak</a></li>
<li class="toctree-l2"><a class="reference internal" href="parameter_summary.html">Summary of SrMise parameters</a></li>
<li class="toctree-l2"><a class="reference internal" href="fit_initial.html">Peak fitting</a></li>
<li class="toctree-l2"><a class="reference internal" href="query_results.html">Querying SrMise results</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Multimodeling with known uncertainty</a></li>
<li class="toctree-l2"><a class="reference internal" href="multimodel_unknown_uncertainties.html">Multimodeling with unknown uncertainty</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../extending.html">Extending SrMise</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/diffpy.srmise.html">Package API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../release.html">Release Notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../license.html">License</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">diffpy.srmise</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="index.html">Tutorial</a></li>
      <li class="breadcrumb-item active">Multimodeling with known uncertainty</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/tutorial/multimodel_known_uncertainties.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <blockquote>
<div></div></blockquote>
<section id="multimodeling-with-known-uncertainty">
<h1>Multimodeling with known uncertainty<a class="headerlink" href="#multimodeling-with-known-uncertainty" title="Link to this heading"></a></h1>
<div class="line-block">
<div class="line">Scripts: <a class="reference internal" href="#multimodel-known-dg1-py">multimodel_known_dG1.py</a>, <a class="reference internal" href="#multimodel-known-dg2-py">multimodel_known_dG2.py</a></div>
<div class="line">Sample: <a class="reference external" href="index.html#ag">Ag</a></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This example is intended for advanced users.  The API for multimodel
selection is expected to change dramatically in a future version of SrMise.
At present multimodel selection in SrMise requires each point in the PDF be
assigned identical uncertainty.  Using the mean uncertainty of a
Nyquist-sampled PDF is suggested.</p>
</div>
<p>The Akaike information criterion (AIC) is a powerful but straightforward method
for multimodel selection, which in the context of SrMise means ranking
individual models (i.e. a set of peaks and baselines) by their “Akaike
probabilities.”  These are, in brief, an asymptotic estimate of the expected
(with respect to the data) and relative (with respect to the models under
consideration) likelihood that a particular model is the best model in the sense
of least Kullback-Leibler divergence.  This approach has a basis in fundamental
concepts of information theory, and shares some conceptual similarities to
cross validation.  Qualitatively speaking, a good model is both simple (has
few parameters) and fits the data well (has a small residual, e.g. the
chi-square error), but improving one of these often comes with a cost to the
other.  The AIC manages this tradeoff between model complexity and
goodness-of-fit.</p>
<p>A formal introduction to these methods is beyond the scope of this example.
Investigators are encouraged to consult Burnham and Anderson’s “Model Selection
and Multimodel Inference” (New York: Springer, 2002) for a general introduction
to AIC-based multimodeling.  See also the paper describing SrMise and the
<a class="reference external" href="https://dx.doi.org/10.1107/S2053273315005276">ParSCAPE algorithm</a> for details about this method as applied to peak
extraction from pair distribution functions.</p>
<p>The suggested approach to multimodel selection with SrMise is generating a
population of models of varying complexity by treating the experimental
uncertainty dG of PDF G(r) as a parameter, denoted dg, across multiple SrMise
trials.  These models may be very similar, and such model redundancy is reduced
by creating classes of similar models, namely those with the same number and
type of peak, and very similar peak parameters.  Each class, represented by the
constituent model with least chi-square error, is considered distinct for the
purpose of the multimodel analysis.  The Akaike probabilities are evaluated for
each class, and from these the investigator may identify the set of most
promising models for additional analysis.  The investigator’s <em>a priori</em>
knowledge of a system, such that a particular model is unphysical, can be
leveraged by excluding that model and recalculating the Akaike probabilities.</p>
<p>Details of the multimodeling procedure are discussed in the comments of the
extraction and analysis scripts.  Run these, noting that the extraction script
may take several minutes to complete.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">python</span> <span class="n">multimodel_known_dG1</span><span class="o">.</span><span class="n">py</span>
<span class="n">python</span> <span class="n">multimodel_known_dG2</span><span class="o">.</span><span class="n">py</span>
</pre></div>
</div>
<section id="extraction-script-multimodel-known-dg1-py">
<span id="multimodel-known-dg1-py"></span><h2>Extraction Script (multimodel_known_dG1.py)<a class="headerlink" href="#extraction-script-multimodel-known-dg1-py" title="Link to this heading"></a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/env python</span>
<span class="c1">##############################################################################</span>
<span class="c1">#</span>
<span class="c1"># diffpy.srmise     by Luke Granlund</span>
<span class="c1">#                   (c) 2015 trustees of the Michigan State University.</span>
<span class="c1">#                   All rights reserved.</span>
<span class="c1">#</span>
<span class="c1"># File coded by:    Luke Granlund</span>
<span class="c1">#</span>
<span class="c1"># See LICENSE.txt for license information.</span>
<span class="c1">#</span>
<span class="c1">##############################################################################</span>
<span class="sd">&quot;&quot;&quot;Extract multiple models from crystalline PDF with known uncertainties for</span>
<span class="sd">use in later AIC-driven multimodeling analysis.</span>

<span class="sd">The multimodel approach generates many models of varying complexity by assuming</span>
<span class="sd">a range of experimental uncertainties are physically plausible.  This example</span>
<span class="sd">shows how to generate multiple models from a crystalline silver PDF with</span>
<span class="sd">experimentally determined uncertainties.  The Akaike Information Criterion (AIC)</span>
<span class="sd">will later be used to see which models are relatively more likely to describe</span>
<span class="sd">the experimental data.  For complex PDFs, especially, there are many sets of</span>
<span class="sd">peaks which are physically distinct yet appear to fit the experimental data</span>
<span class="sd">similarly well.  Multimodeling can help determine which models are worth</span>
<span class="sd">investigating first.</span>

<span class="sd">NOTE: The multimodeling API used here is expected to change drastically in a</span>
<span class="sd">future version of diffpy.srmise.</span>

<span class="sd">For more information on the multimodeling approach taken here see</span>
<span class="sd">[1] Granlund, et al. (2015) Acta Crystallographica A, 71(4), 392-409.</span>
<span class="sd">    doi:10.1107/S2053273315005276</span>
<span class="sd">The standard reference of AIC-based multimodel selection is</span>
<span class="sd">[2] Burnham and Anderson. (2002). Model Selection and Multimodel Inference.</span>
<span class="sd">    New York, NY: Springer. doi:10.1007/b97636</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="kn">import</span> <span class="nn">diffpy.srmise.srmiselog</span> <span class="k">as</span> <span class="nn">sml</span>
<span class="kn">from</span> <span class="nn">diffpy.srmise.multimodelselection</span> <span class="kn">import</span> <span class="n">MultimodelSelection</span>
<span class="kn">from</span> <span class="nn">diffpy.srmise.pdfpeakextraction</span> <span class="kn">import</span> <span class="n">PDFPeakExtraction</span>


<span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="n">plot</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>

    <span class="c1"># Suppress mundane output</span>
    <span class="c1"># When running scripts, especially involving multiple trials, it can be</span>
    <span class="c1"># useful to suppress many of the diffpy.srmise messages.  Valid levels</span>
    <span class="c1"># include &quot;debug&quot;, &quot;info&quot; (the default), &quot;warning&quot;, &quot;error&quot;, and</span>
    <span class="c1"># &quot;critical.&quot;  See diffpy.srmise.srmiselog for more information.</span>
    <span class="n">sml</span><span class="o">.</span><span class="n">setlevel</span><span class="p">(</span><span class="s2">&quot;warning&quot;</span><span class="p">)</span>

    <span class="c1"># Initialize peak extraction from saved trial</span>
    <span class="n">ppe</span> <span class="o">=</span> <span class="n">PDFPeakExtraction</span><span class="p">()</span>
    <span class="n">ppe</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="s2">&quot;output/query_results.srmise&quot;</span><span class="p">)</span>
    <span class="n">ppe</span><span class="o">.</span><span class="n">clearcalc</span><span class="p">()</span>

    <span class="c1"># Set up extraction parameters</span>
    <span class="c1"># All parameters loaded from .srmise file.</span>
    <span class="c1"># Setting new values will override the previous values.</span>
    <span class="n">kwds</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">kwds</span><span class="p">[</span><span class="s2">&quot;rng&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mf">10.9</span><span class="p">,</span> <span class="mi">15</span><span class="p">]</span>  <span class="c1"># Region of PDF with some overlap.</span>
    <span class="n">ppe</span><span class="o">.</span><span class="n">setvars</span><span class="p">(</span><span class="o">**</span><span class="n">kwds</span><span class="p">)</span>

    <span class="c1"># Create multimodel selection object.</span>
    <span class="c1"># The MultimodelSelection class keeps track of the results of peak</span>
    <span class="c1"># extraction as the assumed uncertainty dg is varied.</span>
    <span class="n">ms</span> <span class="o">=</span> <span class="n">MultimodelSelection</span><span class="p">()</span>
    <span class="n">ms</span><span class="o">.</span><span class="n">setppe</span><span class="p">(</span><span class="n">ppe</span><span class="p">)</span>

    <span class="c1"># Define range of dg values</span>
    <span class="c1"># For the purpose of illustration use 15 evenly-spaced values of dg where</span>
    <span class="c1"># 50% &lt; dg &lt; 120% of mean experimental dG in extraction range.</span>
    <span class="n">dg_mean</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">ppe</span><span class="o">.</span><span class="n">dy</span><span class="p">[</span><span class="n">ppe</span><span class="o">.</span><span class="n">getrangeslice</span><span class="p">()])</span>
    <span class="n">dgs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">0.5</span> <span class="o">*</span> <span class="n">dg_mean</span><span class="p">,</span> <span class="mf">1.2</span> <span class="o">*</span> <span class="n">dg_mean</span><span class="p">,</span> <span class="mi">15</span><span class="p">)</span>

    <span class="c1"># Perform peak extraction for each of the assumed uncertainties.</span>
    <span class="n">ms</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">dgs</span><span class="p">)</span>

    <span class="c1"># Save results</span>
    <span class="c1"># The file known_dG_models.dat saves the models generated above.  The file</span>
    <span class="c1"># known_dG_aics.dat saves the value of the AIC of each model when evaluated</span>
    <span class="c1"># on a Nyquist-sampled grid using each of the dg values used to generate</span>
    <span class="c1"># the models in the first place.</span>
    <span class="n">dr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="n">ppe</span><span class="o">.</span><span class="n">qmax</span>
    <span class="n">ms</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="s2">&quot;output/known_dG_models.dat&quot;</span><span class="p">)</span>
    <span class="n">ms</span><span class="o">.</span><span class="n">makeaics</span><span class="p">(</span><span class="n">dgs</span><span class="p">,</span> <span class="n">dr</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="s2">&quot;output/known_dG_aics.dat&quot;</span><span class="p">)</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">run</span><span class="p">()</span>
</pre></div>
</div>
</section>
<section id="analysis-script-multimodel-known-dg2-py">
<span id="multimodel-known-dg2-py"></span><h2>Analysis Script (multimodel_known_dG2.py)<a class="headerlink" href="#analysis-script-multimodel-known-dg2-py" title="Link to this heading"></a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/env python</span>
<span class="c1">##############################################################################</span>
<span class="c1">#</span>
<span class="c1"># diffpy.srmise     by Luke Granlund</span>
<span class="c1">#                   (c) 2015 trustees of the Michigan State University.</span>
<span class="c1">#                   All rights reserved.</span>
<span class="c1">#</span>
<span class="c1"># File coded by:    Luke Granlund</span>
<span class="c1">#</span>
<span class="c1"># See LICENSE.txt for license information.</span>
<span class="c1">#</span>
<span class="c1">##############################################################################</span>
<span class="sd">&quot;&quot;&quot;AIC-driven multimodel analysis of crystalline PDF with known uncertainties.</span>

<span class="sd">The multimodel approach generates many models of varying complexity by assuming</span>
<span class="sd">a range of experimental uncertainties are physically plausible.  This example</span>
<span class="sd">shows how to analyze multiple models obtained (in the previous script) from a</span>
<span class="sd">crystalline silver PDF with experimentally determined uncertainties.  This</span>
<span class="sd">involves calculating the Akaike probabilities, which are a measure of the</span>
<span class="sd">likelihood that a given model is the best model (in the sense of</span>
<span class="sd">Kullback-Leibler divergence) relative to all the other ones in the same</span>
<span class="sd">comparison.</span>

<span class="sd">NOTE: The multimodeling API used here is expected to change drastically in a</span>
<span class="sd">future version of diffpy.srmise.</span>

<span class="sd">For more information on the multimodeling approach taken here see</span>
<span class="sd">[1] Granlund, et al. (2015) Acta Crystallographica A, 71(4), 392-409.</span>
<span class="sd">    doi:10.1107/S2053273315005276</span>
<span class="sd">The standard reference of AIC-based multimodel selection is</span>
<span class="sd">[2] Burnham and Anderson. (2002). Model Selection and Multimodel Inference.</span>
<span class="sd">    New York, NY: Springer. doi:10.1007/b97636</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="kn">import</span> <span class="nn">diffpy.srmise.srmiselog</span> <span class="k">as</span> <span class="nn">sml</span>
<span class="kn">from</span> <span class="nn">diffpy.srmise.applications.plot</span> <span class="kn">import</span> <span class="n">makeplot</span>
<span class="kn">from</span> <span class="nn">diffpy.srmise.multimodelselection</span> <span class="kn">import</span> <span class="n">MultimodelSelection</span>

<span class="c1"># distances from ideal Ag (refined to PDF)</span>
<span class="n">dcif</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
    <span class="p">[</span>
        <span class="mf">11.2394</span><span class="p">,</span>
        <span class="mf">11.608</span><span class="p">,</span>
        <span class="mf">11.9652</span><span class="p">,</span>
        <span class="mf">12.3121</span><span class="p">,</span>
        <span class="mf">12.6495</span><span class="p">,</span>
        <span class="mf">12.9781</span><span class="p">,</span>
        <span class="mf">13.2986</span><span class="p">,</span>
        <span class="mf">13.6116</span><span class="p">,</span>
        <span class="mf">13.9175</span><span class="p">,</span>
        <span class="mf">14.2168</span><span class="p">,</span>
        <span class="mf">14.51</span><span class="p">,</span>
        <span class="mf">14.7973</span><span class="p">,</span>
    <span class="p">]</span>
<span class="p">)</span>


<span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="n">plot</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>

    <span class="c1"># Suppress mundane output</span>
    <span class="n">sml</span><span class="o">.</span><span class="n">setlevel</span><span class="p">(</span><span class="s2">&quot;warning&quot;</span><span class="p">)</span>

    <span class="c1"># Create multimodeling object and load diffpy.srmise results from file.</span>
    <span class="n">ms</span> <span class="o">=</span> <span class="n">MultimodelSelection</span><span class="p">()</span>
    <span class="n">ms</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s2">&quot;output/known_dG_models.dat&quot;</span><span class="p">)</span>
    <span class="n">ms</span><span class="o">.</span><span class="n">loadaics</span><span class="p">(</span><span class="s2">&quot;output/known_dG_aics.dat&quot;</span><span class="p">)</span>

    <span class="c1"># Use Nyquist sampling</span>
    <span class="c1"># Standard AIC analysis assumes the data have independent uncertainties.</span>
    <span class="c1"># Nyquist sampling minimizes correlations in the PDF, which is the closest</span>
    <span class="c1"># approximation to independence possible for the PDF.</span>
    <span class="n">dr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="n">ms</span><span class="o">.</span><span class="n">ppe</span><span class="o">.</span><span class="n">qmax</span>
    <span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">dr2</span><span class="p">,</span> <span class="n">dy</span><span class="p">)</span> <span class="o">=</span> <span class="n">ms</span><span class="o">.</span><span class="n">ppe</span><span class="o">.</span><span class="n">resampledata</span><span class="p">(</span><span class="n">dr</span><span class="p">)</span>

    <span class="c1"># Classify models</span>
    <span class="c1"># All models are placed into classes.  Models in the same class</span>
    <span class="c1"># should be essentially identical (same peak parameters, etc.)</span>
    <span class="c1"># up to a small tolerance determined by comparing individual peaks. The</span>
    <span class="c1"># best model in each class essentially stands in for all the other models</span>
    <span class="c1"># in a class in the rest of the analysis.  A tolerance of 0 indicates the</span>
    <span class="c1"># models must be exactly identical.  Increasing the tolerance allows</span>
    <span class="c1"># increasingly different models to be classified as &quot;identical.&quot;  This step</span>
    <span class="c1"># reduces a major source of model redundancy, which otherwise weakens</span>
    <span class="c1"># AIC-based analysis.  As a rule of thumb, AIC-based analysis is robust</span>
    <span class="c1"># to redundant poor models (since they contribute very little to the Akaike</span>
    <span class="c1"># probabilities in any case), but redundant good models can significantly</span>
    <span class="c1"># alter how models are ranked.  See Granlund (2015) for details.</span>
    <span class="n">tolerance</span> <span class="o">=</span> <span class="mf">0.2</span>
    <span class="n">ms</span><span class="o">.</span><span class="n">classify</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">tolerance</span><span class="p">)</span>

    <span class="c1"># Summarize various facts about the analysis.</span>
    <span class="n">num_models</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">ms</span><span class="o">.</span><span class="n">results</span><span class="p">)</span>
    <span class="n">num_classes</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">ms</span><span class="o">.</span><span class="n">classes</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;------- Multimodeling Summary --------&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Models: </span><span class="si">%i</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">num_models</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Classes: </span><span class="si">%i</span><span class="s2"> (tol=</span><span class="si">%s</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">num_classes</span><span class="p">,</span> <span class="n">tolerance</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Range of dgs: </span><span class="si">%f</span><span class="s2">-</span><span class="si">%f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">ms</span><span class="o">.</span><span class="n">dgs</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ms</span><span class="o">.</span><span class="n">dgs</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]))</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Nyquist-sampled data points: </span><span class="si">%i</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">r</span><span class="p">))</span>

    <span class="c1"># Get dG usable as key in analysis.</span>
    <span class="c1"># The Akaike probabilities were calculated for many assumed values of the</span>
    <span class="c1"># experimental uncertainty dG, and each of these assumed dG is used as a</span>
    <span class="c1"># key when obtaining the corresponding results.  Numerical precision can</span>
    <span class="c1"># make recalculating the exact value difficult, so the dg_key method returns</span>
    <span class="c1"># the key closest to its argument.</span>
    <span class="n">dG</span> <span class="o">=</span> <span class="n">ms</span><span class="o">.</span><span class="n">dg_key</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">ms</span><span class="o">.</span><span class="n">ppe</span><span class="o">.</span><span class="n">dy</span><span class="p">))</span>

    <span class="c1"># Find &quot;best&quot; models.</span>
    <span class="c1"># In short, models with greatest Akaike probability.  Akaike probabilities</span>
    <span class="c1"># can only be validly compared if they were calculated for identical data,</span>
    <span class="c1"># namely identical PDF values *and* uncertainties, and are only reliable</span>
    <span class="c1"># with respect to the actual experiment when using a Nyquist-sampled PDF</span>
    <span class="c1"># with experimentally determined uncertainties.</span>
    <span class="c1">#</span>
    <span class="c1"># The present PDF satisifes these conditions, so the rankings below reflect</span>
    <span class="c1"># an AIC-based estimate of which of the tested models the data best support.</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">--------- Model Rankings for dG = </span><span class="si">%f</span><span class="s2"> ---------&quot;</span> <span class="o">%</span> <span class="n">dG</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Rank  Model  Class  Free         AIC   Prob  File&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ms</span><span class="o">.</span><span class="n">classes</span><span class="p">)):</span>

        <span class="c1"># Generate information about best model in ith best class.</span>
        <span class="c1"># The get(dG, *args, **kwds) method returns a tuple of values</span>
        <span class="c1"># corresponding to string arguments for the best model in best class at</span>
        <span class="c1"># given dG. When the corder keyword is given it returns the model from</span>
        <span class="c1"># the corderth best class (where 0 is best, 1 is next best, etc.)</span>
        <span class="c1"># &quot;model&quot; -&gt; index of model</span>
        <span class="c1"># &quot;class&quot; -&gt; index of class</span>
        <span class="c1"># &quot;nfree&quot; -&gt; number of free parameters in corresponding model</span>
        <span class="c1"># &quot;aic&quot; -&gt; The AIC for this model given uncertainty dG</span>
        <span class="c1"># &quot;prob&quot; -&gt; The AIC probability given uncertainty dG</span>
        <span class="c1"># These all have dedicated getter functions.  For example, the model</span>
        <span class="c1"># index can also be obtained using get_model(dG, corder=i)</span>
        <span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="bp">cls</span><span class="p">,</span> <span class="n">nfree</span><span class="p">,</span> <span class="n">aic</span><span class="p">,</span> <span class="n">prob</span><span class="p">)</span> <span class="o">=</span> <span class="n">ms</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">dG</span><span class="p">,</span> <span class="s2">&quot;model&quot;</span><span class="p">,</span> <span class="s2">&quot;class&quot;</span><span class="p">,</span> <span class="s2">&quot;nfree&quot;</span><span class="p">,</span> <span class="s2">&quot;aic&quot;</span><span class="p">,</span> <span class="s2">&quot;prob&quot;</span><span class="p">,</span> <span class="n">corder</span><span class="o">=</span><span class="n">i</span><span class="p">)</span>

        <span class="n">filename_base</span> <span class="o">=</span> <span class="s2">&quot;output/known_dG_m&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>

        <span class="c1"># print(info for this model</span>
        <span class="nb">print</span><span class="p">(</span>
            <span class="s2">&quot;</span><span class="si">%4i</span><span class="s2">  </span><span class="si">%5i</span><span class="s2">  </span><span class="si">%5i</span><span class="s2">  </span><span class="si">%4i</span><span class="s2">  </span><span class="si">%10.4e</span><span class="s2"> </span><span class="si">%6.3f</span><span class="s2">  </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="bp">cls</span><span class="p">,</span> <span class="n">nfree</span><span class="p">,</span> <span class="n">aic</span><span class="p">,</span> <span class="n">prob</span><span class="p">,</span> <span class="n">filename_base</span> <span class="o">+</span> <span class="s2">&quot;.pwa&quot;</span><span class="p">)</span>
        <span class="p">)</span>

        <span class="c1"># A message added as a comment to saved .pwa file.</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s2">&quot;Multimodeling Summary&quot;</span><span class="p">,</span>
            <span class="s2">&quot;---------------------&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Evaluated at dG: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">dG</span><span class="p">,</span>
            <span class="s2">&quot;Model: </span><span class="si">%i</span><span class="s2"> (of </span><span class="si">%i</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">num_models</span><span class="p">),</span>
            <span class="s2">&quot;Class: </span><span class="si">%i</span><span class="s2"> (of </span><span class="si">%i</span><span class="s2">, tol=</span><span class="si">%s</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">num_classes</span><span class="p">,</span> <span class="n">tolerance</span><span class="p">),</span>
            <span class="s2">&quot;Akaike probability: </span><span class="si">%g</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">prob</span><span class="p">,</span>
            <span class="s2">&quot;Rank: </span><span class="si">%i</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span>
        <span class="p">]</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

        <span class="c1"># Make this the active model</span>
        <span class="n">ms</span><span class="o">.</span><span class="n">setcurrent</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>

        <span class="c1"># Save .pwa</span>
        <span class="n">ms</span><span class="o">.</span><span class="n">ppe</span><span class="o">.</span><span class="n">writepwa</span><span class="p">(</span><span class="n">filename_base</span> <span class="o">+</span> <span class="s2">&quot;.pwa&quot;</span><span class="p">,</span> <span class="n">msg</span><span class="p">)</span>

        <span class="c1"># Plot this model</span>
        <span class="k">if</span> <span class="n">plot</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
            <span class="n">makeplot</span><span class="p">(</span><span class="n">ms</span><span class="o">.</span><span class="n">ppe</span><span class="p">,</span> <span class="n">dcif</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Model </span><span class="si">%i</span><span class="s2">/Class </span><span class="si">%i</span><span class="s2"> (Rank </span><span class="si">%i</span><span class="s2">, AIC prob=</span><span class="si">%f</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="bp">cls</span><span class="p">,</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">prob</span><span class="p">))</span>
            <span class="c1"># Uncomment line below to save figures.</span>
            <span class="c1"># plt.savefig(filename_base + &quot;.png&quot;, format=&quot;png&quot;)</span>

    <span class="c1"># 3D plot of Akaike probabilities</span>
    <span class="c1"># This plot shows the Akaike probabilities of all classes as a function</span>
    <span class="c1"># of assumed uncertainty dG.  This gives a rough sense of how the models</span>
    <span class="c1"># selected by an AIC-based analysis would vary if the experimental</span>
    <span class="c1"># uncertainties contributing to the observed G(r) were different.  The</span>
    <span class="c1"># Akaike probabilities calculated for the actual experimental uncertainty</span>
    <span class="c1"># are highlighted.</span>
    <span class="k">if</span> <span class="n">plot</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
        <span class="n">ms</span><span class="o">.</span><span class="n">plot3dclassprobs</span><span class="p">(</span><span class="n">probfilter</span><span class="o">=</span><span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">],</span> <span class="n">highlight</span><span class="o">=</span><span class="p">[</span><span class="n">dG</span><span class="p">])</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
        <span class="c1"># Uncomment line below to save figure.</span>
        <span class="c1"># plt.savefig(&quot;output/known_dG_probs.png&quot;, format=&quot;png&quot;, bbox_inches=&quot;tight&quot;)</span>

    <span class="k">if</span> <span class="n">plot</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">run</span><span class="p">()</span>
</pre></div>
</div>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="query_results.html" class="btn btn-neutral float-left" title="Querying SrMise results" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="multimodel_unknown_uncertainties.html" class="btn btn-neutral float-right" title="Multimodeling with unknown uncertainty" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2024, The Trustees of Columbia University in the City of New York.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>