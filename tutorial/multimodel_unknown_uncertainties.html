<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Multimodeling with unknown uncertainty &mdash; diffpy.srmise 0.1.0rc1 documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=fa44fd50" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=19f00094" />

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../_static/jquery.js?v=5d32c60e"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../_static/documentation_options.js?v=3b45b1b0"></script>
        <script src="../_static/doctools.js?v=9a2dae69"></script>
        <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Extending SrMise" href="../extending.html" />
    <link rel="prev" title="Multimodeling with known uncertainty" href="multimodel_known_uncertainties.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            diffpy.srmise
          </a>
              <div class="version">
                0.1.0rc1
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Tutorial</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="extract_single_peak.html">Peak extraction of a single peak</a></li>
<li class="toctree-l2"><a class="reference internal" href="parameter_summary.html">Summary of SrMise parameters</a></li>
<li class="toctree-l2"><a class="reference internal" href="fit_initial.html">Peak fitting</a></li>
<li class="toctree-l2"><a class="reference internal" href="query_results.html">Querying SrMise results</a></li>
<li class="toctree-l2"><a class="reference internal" href="multimodel_known_uncertainties.html">Multimodeling with known uncertainty</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Multimodeling with unknown uncertainty</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../extending.html">Extending SrMise</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/diffpy.srmise.html">Package API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../release.html">Release Notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../license.html">License</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">diffpy.srmise</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="index.html">Tutorial</a></li>
      <li class="breadcrumb-item active">Multimodeling with unknown uncertainty</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/tutorial/multimodel_unknown_uncertainties.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <blockquote>
<div></div></blockquote>
<section id="multimodeling-with-unknown-uncertainty">
<h1>Multimodeling with unknown uncertainty<a class="headerlink" href="#multimodeling-with-unknown-uncertainty" title="Link to this heading"></a></h1>
<div class="line-block">
<div class="line">Scripts: <a class="reference internal" href="#multimodel-unknown-dg1-py">multimodel_unknown_dG1.py</a>, <a class="reference internal" href="#multimodel-unknown-dg2-py">multimodel_unknown_dG2.py</a></div>
<div class="line">Sample: <a class="reference external" href="index.html#c60">C<sub>60</sub></a></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This example is intended for advanced users.  The API for multimodel
selection is expected to change dramatically in a future version of SrMise.
At present multimodel selection in SrMise requires each point in the PDF
be assigned identical uncertainty.</p>
</div>
<p>Multimodel selection with SrMise when experimental uncertainties are unknown is
challenging, and without an independent estimate of these uncertainties the
usual AIC-based multimodeling analysis of the previous example is not possible.
To be specific, the procedure in the previous example can be carried out under
the assumption that some <em>ad hoc</em> uncertainty is correct, but results are
clearly dependent upon that choice.</p>
<p>The approach taken here, detailed in the paper describing the
<a class="reference external" href="https://dx.doi.org/10.1107/S2053273315005276">ParSCAPE algorithm</a>, is to evaluate the Akaike probabilities over a broad
range of <em>ad hoc</em> uncertainties, typically the same range used to generate the
population of models in the first place.  Then, identify the set of classes
which have greatest Akaike probability for at least one of the evaluated
uncertainties.  This choice embodies ignorance of experimentally-determined
uncertainties.  Unlike a standard AIC-based multimodeling analysis, these
classes have no particular information theoretic relationship with each other
since their Akaike probabilities were calculated assuming different
uncertainties.  However, if the true experimental uncertainty lies within the
interval tested, this set of classes necessarily contains the one that would be
selected as best were the experimental uncertainties known.  This is,
nevertheless, a significantly less powerful analysis than is possible when
the experimental uncertainties are known.</p>
<p>Details of the multimodeling procedure are discussed in the comments of the
extraction and analysis scripts.  Run these, noting that the extraction script
may take several minutes to complete.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">python</span> <span class="n">multimodel_unknown_dG1</span><span class="o">.</span><span class="n">py</span>
<span class="n">python</span> <span class="n">multimodel_unknown_dG2</span><span class="o">.</span><span class="n">py</span>
</pre></div>
</div>
<section id="extraction-script-multimodel-unknown-dg1-py">
<span id="multimodel-unknown-dg1-py"></span><h2>Extraction Script (multimodel_unknown_dG1.py)<a class="headerlink" href="#extraction-script-multimodel-unknown-dg1-py" title="Link to this heading"></a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/env python</span>
<span class="c1">##############################################################################</span>
<span class="c1">#</span>
<span class="c1"># diffpy.srmise     by Luke Granlund</span>
<span class="c1">#                   (c) 2015 trustees of the Michigan State University.</span>
<span class="c1">#                   All rights reserved.</span>
<span class="c1">#</span>
<span class="c1"># File coded by:    Luke Granlund</span>
<span class="c1">#</span>
<span class="c1"># See LICENSE.txt for license information.</span>
<span class="c1">#</span>
<span class="c1">##############################################################################</span>
<span class="sd">&quot;&quot;&quot;Extract multiple models from nanoparticle PDF with unknown uncertainties for</span>
<span class="sd">use in later AIC-driven multimodeling analysis.</span>

<span class="sd">The multimodel approach generates many models of varying complexity by assuming</span>
<span class="sd">a range of experimental uncertainties are physically plausible.  This example</span>
<span class="sd">shows how to generate multiple models from a C60 nanoparticle PDF with</span>
<span class="sd">unreliable uncertainties.  The Akaike Information Criterion (AIC) will later be</span>
<span class="sd">used to see which models are relatively more likely to describe the experimental</span>
<span class="sd">data.  For complex PDFs, especially, there are many sets of peaks which are</span>
<span class="sd">physically distinct yet appear to fit the experimental data similarly well.</span>
<span class="sd">Multimodeling can help determine which models are worth investigating first.</span>

<span class="sd">NOTE: The multimodeling API used here is expected to change drastically in a</span>
<span class="sd">future version of diffpy.srmise.</span>

<span class="sd">For more information on the multimodeling approach taken here see</span>
<span class="sd">[1] Granlund, et al. (2015) Acta Crystallographica A, 71(4), 392-409.</span>
<span class="sd">    doi:10.1107/S2053273315005276</span>
<span class="sd">The standard reference of AIC-based multimodel selection is</span>
<span class="sd">[2] Burnham and Anderson. (2002). Model Selection and Multimodel Inference.</span>
<span class="sd">    New York, NY: Springer. doi:10.1007/b97636</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="kn">import</span> <span class="nn">diffpy.srmise.srmiselog</span> <span class="k">as</span> <span class="nn">sml</span>
<span class="kn">from</span> <span class="nn">diffpy.srmise.baselines.fromsequence</span> <span class="kn">import</span> <span class="n">FromSequence</span>
<span class="kn">from</span> <span class="nn">diffpy.srmise.multimodelselection</span> <span class="kn">import</span> <span class="n">MultimodelSelection</span>
<span class="kn">from</span> <span class="nn">diffpy.srmise.pdfpeakextraction</span> <span class="kn">import</span> <span class="n">PDFPeakExtraction</span>


<span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="n">plot</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>

    <span class="c1"># Suppress mundane output</span>
    <span class="c1"># When running scripts, especially involving multiple trials, it can be</span>
    <span class="c1"># useful to suppress many of the diffpy.srmise messages.  Valid levels</span>
    <span class="c1"># include &quot;debug&quot;, &quot;info&quot; (the default), &quot;warning&quot;, &quot;error&quot;, and</span>
    <span class="c1"># &quot;critical.&quot;  See diffpy.srmise.srmiselog for more information.</span>
    <span class="n">sml</span><span class="o">.</span><span class="n">setlevel</span><span class="p">(</span><span class="s2">&quot;warning&quot;</span><span class="p">)</span>

    <span class="c1"># Initialize peak extraction</span>
    <span class="n">ppe</span> <span class="o">=</span> <span class="n">PDFPeakExtraction</span><span class="p">()</span>
    <span class="n">ppe</span><span class="o">.</span><span class="n">loadpdf</span><span class="p">(</span><span class="s2">&quot;data/C60_fine_qmax21.gr&quot;</span><span class="p">)</span>

    <span class="c1"># Set up extraction parameters</span>
    <span class="c1"># The FromSequence baseline interpolates (r, G(r)) values read from a</span>
    <span class="c1"># specified file.  It has parameters.  This particular baseline was</span>
    <span class="c1"># calculated by approximating the C60 sample as a face-centered cubic</span>
    <span class="c1"># lattice of hollow spheres.</span>
    <span class="n">blfunc</span> <span class="o">=</span> <span class="n">FromSequence</span><span class="p">(</span><span class="s2">&quot;data/C60baseline.dat&quot;</span><span class="p">)</span>
    <span class="n">kwds</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">kwds</span><span class="p">[</span><span class="s2">&quot;rng&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">7.25</span><span class="p">]</span>
    <span class="n">kwds</span><span class="p">[</span><span class="s2">&quot;baseline&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">blfunc</span><span class="o">.</span><span class="n">actualize</span><span class="p">([])</span>
    <span class="n">kwds</span><span class="p">[</span><span class="s2">&quot;cres&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.05</span>
    <span class="n">ppe</span><span class="o">.</span><span class="n">setvars</span><span class="p">(</span><span class="o">**</span><span class="n">kwds</span><span class="p">)</span>

    <span class="c1"># Create multimodel selection object.</span>
    <span class="c1"># The MultimodelSelection class keeps track of the results of peak</span>
    <span class="c1"># extraction as the assumed uncertainty dg is varied.</span>
    <span class="n">ms</span> <span class="o">=</span> <span class="n">MultimodelSelection</span><span class="p">()</span>
    <span class="n">ms</span><span class="o">.</span><span class="n">setppe</span><span class="p">(</span><span class="n">ppe</span><span class="p">)</span>

    <span class="c1"># Define range of dg values</span>
    <span class="c1"># For the purpose of illustration use 20 evenly-spaced values of dg where</span>
    <span class="c1"># 1% &lt; dg &lt; 10% of max gr value between r=1 and 7.25.</span>
    <span class="n">grmax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">ppe</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">ppe</span><span class="o">.</span><span class="n">getrangeslice</span><span class="p">()])</span>
    <span class="n">dgs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">0.01</span> <span class="o">*</span> <span class="n">grmax</span><span class="p">,</span> <span class="mf">0.10</span> <span class="o">*</span> <span class="n">grmax</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span>

    <span class="c1"># Perform peak extraction for each of the assumed uncertainties.</span>
    <span class="n">ms</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">dgs</span><span class="p">)</span>

    <span class="c1"># Save results</span>
    <span class="c1"># The file C60_models.dat saves the models generated above.  The file</span>
    <span class="c1"># C60_aics.dat saves the value of the AIC of each model when evaluated</span>
    <span class="c1"># on a Nyquist-sampled grid using each of the dg values used to generate</span>
    <span class="c1"># the models in the first place.</span>
    <span class="n">dr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="n">ppe</span><span class="o">.</span><span class="n">qmax</span>
    <span class="n">ms</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="s2">&quot;output/unknown_dG_models.dat&quot;</span><span class="p">)</span>
    <span class="n">ms</span><span class="o">.</span><span class="n">makeaics</span><span class="p">(</span><span class="n">dgs</span><span class="p">,</span> <span class="n">dr</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="s2">&quot;output/unknown_dG_aics.dat&quot;</span><span class="p">)</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">run</span><span class="p">()</span>
</pre></div>
</div>
</section>
<section id="analysis-script-multimodel-unknown-dg2-py">
<span id="multimodel-unknown-dg2-py"></span><h2>Analysis Script (multimodel_unknown_dG2.py)<a class="headerlink" href="#analysis-script-multimodel-unknown-dg2-py" title="Link to this heading"></a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/env python</span>
<span class="c1">##############################################################################</span>
<span class="c1">#</span>
<span class="c1"># diffpy.srmise     by Luke Granlund</span>
<span class="c1">#                   (c) 2015 trustees of the Michigan State University.</span>
<span class="c1">#                   All rights reserved.</span>
<span class="c1">#</span>
<span class="c1"># File coded by:    Luke Granlund</span>
<span class="c1">#</span>
<span class="c1"># See LICENSE.txt for license information.</span>
<span class="c1">#</span>
<span class="c1">##############################################################################</span>
<span class="sd">&quot;&quot;&quot;AIC-driven multimodel analysis of nanoparticle PDF with unknown</span>
<span class="sd">uncertainties.</span>

<span class="sd">The multimodel approach generates many models of varying complexity by assuming</span>
<span class="sd">a range of experimental uncertainties are physically plausible.  This example</span>
<span class="sd">shows how to analyze multiple models obtained from a C60 nanoparticle PDF with</span>
<span class="sd">unreliable uncertainties.  The Akaike Information Criterion (AIC) can be used to</span>
<span class="sd">see which models are relatively more likely to describe the experimental data.</span>
<span class="sd">For complex PDFs, especially, there are many sets of peaks which are physically</span>
<span class="sd">distinct yet appear to fit the experimental data similarly well.  Here we</span>
<span class="sd">calculate the Akaike probabilities, which are a measure of the likelihood that a</span>
<span class="sd">given model is the best model (in the sense of Kullback-Leibler information</span>
<span class="sd">divergence) relative to all the other ones in the same comparison.  This</span>
<span class="sd">analysis reflects ignorance of the experimental uncertainties by evaluating</span>
<span class="sd">the Akaike probabilities for a range of assumed uncertainties, returning models</span>
<span class="sd">which are selected as best at least once.  This is a weaker analysis than</span>
<span class="sd">possible when the uncertainties are known.</span>

<span class="sd">NOTE: The multimodeling API used here is expected to change drastically in a</span>
<span class="sd">future version of diffpy.srmise.</span>

<span class="sd">For more information on the multimodeling approach taken here see</span>
<span class="sd">[1] Granlund, et al. (2015) Acta Crystallographica A, 71(4), 392-409.</span>
<span class="sd">    doi:10.1107/S2053273315005276</span>
<span class="sd">The standard reference of AIC-based multimodel selection is</span>
<span class="sd">[2] Burnham and Anderson. (2002). Model Selection and Multimodel Inference.</span>
<span class="sd">    New York, NY: Springer. doi:10.1007/b97636</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="kn">import</span> <span class="nn">diffpy.srmise.srmiselog</span> <span class="k">as</span> <span class="nn">sml</span>
<span class="kn">from</span> <span class="nn">diffpy.srmise.applications.plot</span> <span class="kn">import</span> <span class="n">makeplot</span>
<span class="kn">from</span> <span class="nn">diffpy.srmise.multimodelselection</span> <span class="kn">import</span> <span class="n">MultimodelSelection</span>

<span class="c1"># distances from ideal (unrefined) C60</span>
<span class="n">dcif</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
    <span class="p">[</span>
        <span class="mf">1.44</span><span class="p">,</span>
        <span class="mf">2.329968944</span><span class="p">,</span>
        <span class="mf">2.494153163</span><span class="p">,</span>
        <span class="mf">2.88</span><span class="p">,</span>
        <span class="mf">3.595985339</span><span class="p">,</span>
        <span class="mf">3.704477734</span><span class="p">,</span>
        <span class="mf">4.132591264</span><span class="p">,</span>
        <span class="mf">4.520339129</span><span class="p">,</span>
        <span class="mf">4.659937888</span><span class="p">,</span>
        <span class="mf">4.877358006</span><span class="p">,</span>
        <span class="mf">5.209968944</span><span class="p">,</span>
        <span class="mf">5.405310018</span><span class="p">,</span>
        <span class="mf">5.522583786</span><span class="p">,</span>
        <span class="mf">5.818426502</span><span class="p">,</span>
        <span class="mf">6.099937888</span><span class="p">,</span>
        <span class="mf">6.164518388</span><span class="p">,</span>
        <span class="mf">6.529777754</span><span class="p">,</span>
        <span class="mf">6.686673127</span><span class="p">,</span>
        <span class="mf">6.745638756</span><span class="p">,</span>
        <span class="mf">6.989906831</span><span class="p">,</span>
        <span class="mf">7.136693738</span><span class="p">,</span>
    <span class="p">]</span>
<span class="p">)</span>


<span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="n">plot</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>

    <span class="c1"># Suppress mundane output</span>
    <span class="n">sml</span><span class="o">.</span><span class="n">setlevel</span><span class="p">(</span><span class="s2">&quot;warning&quot;</span><span class="p">)</span>

    <span class="c1"># Create multimodeling object and load diffpy.srmise results from file.</span>
    <span class="n">ms</span> <span class="o">=</span> <span class="n">MultimodelSelection</span><span class="p">()</span>
    <span class="n">ms</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s2">&quot;output/unknown_dG_models.dat&quot;</span><span class="p">)</span>
    <span class="n">ms</span><span class="o">.</span><span class="n">loadaics</span><span class="p">(</span><span class="s2">&quot;output/unknown_dG_aics.dat&quot;</span><span class="p">)</span>

    <span class="c1"># Use Nyquist sampling</span>
    <span class="c1"># Standard AIC analysis assumes the data have independent uncertainties.</span>
    <span class="c1"># Nyquist sampling minimizes correlations in the PDF, which is the closest</span>
    <span class="c1"># approximation to independence possible for the PDF.</span>
    <span class="n">dr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="n">ms</span><span class="o">.</span><span class="n">ppe</span><span class="o">.</span><span class="n">qmax</span>
    <span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">dr2</span><span class="p">,</span> <span class="n">dy</span><span class="p">)</span> <span class="o">=</span> <span class="n">ms</span><span class="o">.</span><span class="n">ppe</span><span class="o">.</span><span class="n">resampledata</span><span class="p">(</span><span class="n">dr</span><span class="p">)</span>

    <span class="c1"># Classify models</span>
    <span class="c1"># All models are placed into classes.  Models in the same class</span>
    <span class="c1"># should be essentially identical (same peak parameters, etc.)</span>
    <span class="c1"># up to a small tolerance determined by comparing individual peaks. The</span>
    <span class="c1"># best model in each class essentially stands in for all the other models</span>
    <span class="c1"># in a class in the rest of the analysis.  A tolerance of 0 indicates the</span>
    <span class="c1"># models must be exactly identical.  Increasing the tolerance allows</span>
    <span class="c1"># increasingly different models to be classified as &quot;identical.&quot;  This step</span>
    <span class="c1"># reduces a major source of model redundancy, which otherwise weakens</span>
    <span class="c1"># AIC-based analysis.  As a rule of thumb, AIC-based analysis is robust</span>
    <span class="c1"># to redundant poor models (since they contribute very little to the Akaike</span>
    <span class="c1"># probabilities in any case), but redundant good models can significantly</span>
    <span class="c1"># alter how models are ranked.  See Granlund (2015) for details.</span>
    <span class="n">tolerance</span> <span class="o">=</span> <span class="mf">0.2</span>
    <span class="n">ms</span><span class="o">.</span><span class="n">classify</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">tolerance</span><span class="p">)</span>

    <span class="c1"># Summarize various facts about the analysis.</span>
    <span class="n">num_models</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">ms</span><span class="o">.</span><span class="n">results</span><span class="p">)</span>
    <span class="n">num_classes</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">ms</span><span class="o">.</span><span class="n">classes</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;------- Multimodeling Summary --------&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Models: </span><span class="si">%i</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">num_models</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Classes: </span><span class="si">%i</span><span class="s2"> (tol=</span><span class="si">%s</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">num_classes</span><span class="p">,</span> <span class="n">tolerance</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Range of dgs: </span><span class="si">%f</span><span class="s2">-</span><span class="si">%f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">ms</span><span class="o">.</span><span class="n">dgs</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ms</span><span class="o">.</span><span class="n">dgs</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]))</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Nyquist-sampled data points: </span><span class="si">%i</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">r</span><span class="p">))</span>

    <span class="c1"># Find &quot;best&quot; models.</span>
    <span class="c1"># In short, models with greatest Akaike probability.  Akaike probabilities</span>
    <span class="c1"># can only be validly compared if they were calculated for identical data,</span>
    <span class="c1"># namely identical PDF values *and* uncertainties, and are only reliable</span>
    <span class="c1"># with respect to the actual experiment when using a Nyquist-sampled PDF</span>
    <span class="c1"># with experimentally determined uncertainties.</span>
    <span class="c1">#</span>
    <span class="c1"># In the present case the PDF uncertainties are not reliable, and so the</span>
    <span class="c1"># analysis cannot be performed by specifying the experimental uncertainty</span>
    <span class="c1"># dG.  Instead, perform a weaker analysis, calculating the Akaike</span>
    <span class="c1"># probabilities for a range of assumed dG, and identifying classes which</span>
    <span class="c1"># have greatest probability at least once.  The classes identified in this</span>
    <span class="c1"># way have no particular information-theoretic relationship, but if the</span>
    <span class="c1"># actual experimental uncertainty is in the interval tested, the best</span>
    <span class="c1"># class at the experimental uncertainty is among them.</span>

    <span class="c1"># Get classes which are best for one or more dG, and the specific dG in that</span>
    <span class="c1"># interval at which they attain greatest Akaike probability.</span>
    <span class="n">best_classes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">([</span><span class="n">ms</span><span class="o">.</span><span class="n">get_class</span><span class="p">(</span><span class="n">dG</span><span class="p">)</span> <span class="k">for</span> <span class="n">dG</span> <span class="ow">in</span> <span class="n">ms</span><span class="o">.</span><span class="n">dgs</span><span class="p">])</span>
    <span class="n">best_dGs</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="bp">cls</span> <span class="ow">in</span> <span class="n">best_classes</span><span class="p">:</span>
        <span class="n">cls_probs</span> <span class="o">=</span> <span class="p">[</span><span class="n">ms</span><span class="o">.</span><span class="n">get_prob</span><span class="p">(</span><span class="n">dG</span><span class="p">)</span> <span class="k">if</span> <span class="n">ms</span><span class="o">.</span><span class="n">get_class</span><span class="p">(</span><span class="n">dG</span><span class="p">)</span> <span class="o">==</span> <span class="bp">cls</span> <span class="k">else</span> <span class="mi">0</span> <span class="k">for</span> <span class="n">dG</span> <span class="ow">in</span> <span class="n">ms</span><span class="o">.</span><span class="n">dgs</span><span class="p">]</span>
        <span class="n">dG</span> <span class="o">=</span> <span class="n">ms</span><span class="o">.</span><span class="n">dgs</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">cls_probs</span><span class="p">)]</span>
        <span class="n">best_dGs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dG</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">--------- Best models for at least one dG ---------&quot;</span> <span class="o">%</span> <span class="n">dG</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;   Best dG  Model  Class  Free       AIC     Prob  File&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">dG</span> <span class="ow">in</span> <span class="n">best_dGs</span><span class="p">:</span>

        <span class="c1"># Generate information about best model.</span>
        <span class="c1"># The get(dG, *args, **kwds) method returns a tuple of values</span>
        <span class="c1"># corresponding to string arguments for the best model in best class at</span>
        <span class="c1"># given dG. When the corder keyword is given it returns the model from</span>
        <span class="c1"># the corderth best class (where 0 is best, 1 is next best, etc.)</span>
        <span class="c1"># &quot;model&quot; -&gt; index of model</span>
        <span class="c1"># &quot;class&quot; -&gt; index of class</span>
        <span class="c1"># &quot;nfree&quot; -&gt; number of free parameters in corresponding model</span>
        <span class="c1"># &quot;aic&quot; -&gt; The AIC for this model given uncertainty dG</span>
        <span class="c1"># &quot;prob&quot; -&gt; The AIC probability given uncertainty dG</span>
        <span class="c1"># These all have dedicated getter functions.</span>
        <span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="bp">cls</span><span class="p">,</span> <span class="n">nfree</span><span class="p">,</span> <span class="n">aic</span><span class="p">,</span> <span class="n">prob</span><span class="p">)</span> <span class="o">=</span> <span class="n">ms</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">dG</span><span class="p">,</span> <span class="s2">&quot;model&quot;</span><span class="p">,</span> <span class="s2">&quot;class&quot;</span><span class="p">,</span> <span class="s2">&quot;nfree&quot;</span><span class="p">,</span> <span class="s2">&quot;aic&quot;</span><span class="p">,</span> <span class="s2">&quot;prob&quot;</span><span class="p">)</span>

        <span class="n">filename_base</span> <span class="o">=</span> <span class="s2">&quot;output/unknown_dG_m&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>

        <span class="c1"># print(info for this model</span>
        <span class="nb">print</span><span class="p">(</span>
            <span class="s2">&quot;</span><span class="si">%10.4e</span><span class="s2">  </span><span class="si">%5i</span><span class="s2">  </span><span class="si">%5i</span><span class="s2">  </span><span class="si">%4i</span><span class="s2">  </span><span class="si">%10.4e</span><span class="s2"> </span><span class="si">%6.3f</span><span class="s2">  </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">dG</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="bp">cls</span><span class="p">,</span> <span class="n">nfree</span><span class="p">,</span> <span class="n">aic</span><span class="p">,</span> <span class="n">prob</span><span class="p">,</span> <span class="n">filename_base</span> <span class="o">+</span> <span class="s2">&quot;.pwa&quot;</span><span class="p">)</span>
        <span class="p">)</span>

        <span class="c1"># A message added as a comment to saved .pwa file.</span>
        <span class="n">best_from</span> <span class="o">=</span> <span class="p">[</span><span class="n">dg</span> <span class="k">for</span> <span class="n">dg</span> <span class="ow">in</span> <span class="n">ms</span><span class="o">.</span><span class="n">dgs</span> <span class="k">if</span> <span class="n">ms</span><span class="o">.</span><span class="n">get_class</span><span class="p">(</span><span class="n">dg</span><span class="p">)</span> <span class="o">==</span> <span class="bp">cls</span><span class="p">]</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s2">&quot;Multimodeling Summary&quot;</span><span class="p">,</span>
            <span class="s2">&quot;---------------------&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Model: </span><span class="si">%i</span><span class="s2"> (of </span><span class="si">%i</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">num_models</span><span class="p">),</span>
            <span class="s2">&quot;Class: </span><span class="si">%i</span><span class="s2"> (of </span><span class="si">%i</span><span class="s2">, tol=</span><span class="si">%s</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">num_classes</span><span class="p">,</span> <span class="n">tolerance</span><span class="p">),</span>
            <span class="s2">&quot;Best model from dG: </span><span class="si">%s</span><span class="s2">-</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">best_from</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">best_from</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]),</span>
            <span class="s2">&quot;Evaluated at dG: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">dG</span><span class="p">,</span>
            <span class="s2">&quot;Akaike probability: </span><span class="si">%g</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">prob</span><span class="p">,</span>
        <span class="p">]</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

        <span class="c1"># Make this the active model</span>
        <span class="n">ms</span><span class="o">.</span><span class="n">setcurrent</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>

        <span class="c1"># Save .pwa</span>
        <span class="n">ms</span><span class="o">.</span><span class="n">ppe</span><span class="o">.</span><span class="n">writepwa</span><span class="p">(</span><span class="n">filename_base</span> <span class="o">+</span> <span class="s2">&quot;.pwa&quot;</span><span class="p">,</span> <span class="n">msg</span><span class="p">)</span>

        <span class="c1"># Plot this model</span>
        <span class="k">if</span> <span class="n">plot</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
            <span class="n">makeplot</span><span class="p">(</span><span class="n">ms</span><span class="o">.</span><span class="n">ppe</span><span class="p">,</span> <span class="n">dcif</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Model </span><span class="si">%i</span><span class="s2">/Class </span><span class="si">%i</span><span class="s2"> (Best dG=</span><span class="si">%f</span><span class="s2">, AIC prob=</span><span class="si">%f</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="bp">cls</span><span class="p">,</span> <span class="n">dG</span><span class="p">,</span> <span class="n">prob</span><span class="p">))</span>
            <span class="c1"># Uncomment line below to save figures.</span>
            <span class="c1"># plt.savefig(filename_base + &quot;.png&quot;, format=&quot;png&quot;)</span>

    <span class="c1"># 3D plot of Akaike probabilities</span>
    <span class="c1"># This plot shows the Akaike probabilities of all classes as a function</span>
    <span class="c1"># of assumed uncertainty dG.  This gives a rough sense of how the models</span>
    <span class="c1"># selected by an AIC-based analysis would vary if the experimental</span>
    <span class="c1"># uncertainties contributing to the observed G(r) were different.  Models</span>
    <span class="c1"># are highlighted at the various dG values found above.</span>
    <span class="k">if</span> <span class="n">plot</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
        <span class="n">ms</span><span class="o">.</span><span class="n">plot3dclassprobs</span><span class="p">(</span><span class="n">probfilter</span><span class="o">=</span><span class="p">[</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">],</span> <span class="n">highlight</span><span class="o">=</span><span class="n">best_dGs</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
        <span class="c1"># Uncomment line below to save figure.</span>
        <span class="c1"># plt.savefig(&quot;output/unknown_dG_probs.png&quot;, format=&quot;png&quot;, bbox_inches=&quot;tight&quot;)</span>

    <span class="k">if</span> <span class="n">plot</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">run</span><span class="p">()</span>
</pre></div>
</div>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="multimodel_known_uncertainties.html" class="btn btn-neutral float-left" title="Multimodeling with known uncertainty" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="../extending.html" class="btn btn-neutral float-right" title="Extending SrMise" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2024, The Trustees of Columbia University in the City of New York.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>